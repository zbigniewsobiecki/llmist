# ~/.llmist/cli.toml
# Example configuration file for llmist CLI
#
# Copy this file to ~/.llmist/cli.toml to customize CLI defaults.
# All settings are optional - only specify what you want to override.
#
# INHERITANCE: Any section can use `inherits` to inherit settings from other sections.
# - Single inheritance: inherits = "agent"
# - Multiple inheritance: inherits = ["agent", "my-profile"]  (last wins for conflicts)
# - Chain inheritance: A inherits B, B inherits C → A gets all of C's and B's settings
# - Own values always override inherited values
# - Arrays (like gadget) are replaced, not merged
#
# PROMPT TEMPLATES: The [prompts] section allows defining reusable prompt snippets.
# - Use Eta syntax: <%~ include("@name") %> to include, <%= it.var %> for variables
# - Prompts can include other prompts for composition
# - Access environment variables with <%= it.env.VAR_NAME %>
# - Templates are resolved at config load time

#──────────────────────────────────────────────────────────────────────────────
# GLOBAL OPTIONS
# These apply to all commands and override environment variables.
# CLI flags (--log-level, --log-file) still take priority over these.
#──────────────────────────────────────────────────────────────────────────────
[global]
# log-level = "info"                     # silly, trace, debug, info, warn, error, fatal
# log-file = "/tmp/llmist.log"           # Log file path (enables JSON logging)

#──────────────────────────────────────────────────────────────────────────────
# COMPLETE COMMAND DEFAULTS
# These settings apply when running: llmist complete "prompt"
#──────────────────────────────────────────────────────────────────────────────
[complete]
model = "anthropic:claude-sonnet-4-5"   # Model identifier (provider:model or alias)
# system = "You are a helpful assistant." # System prompt
# temperature = 0.7                      # Sampling temperature (0-2)
# max-tokens = 4096                      # Maximum output tokens
# quiet = false                          # Suppress all output except content

#──────────────────────────────────────────────────────────────────────────────
# AGENT COMMAND DEFAULTS
# These settings apply when running: llmist agent "prompt"
#──────────────────────────────────────────────────────────────────────────────
[agent]
model = "anthropic:claude-sonnet-4-5"
# system = "You are a helpful assistant with access to tools."
# temperature = 0.5
max-iterations = 15                      # Max agent loop iterations
# gadget = [                             # Default gadgets to load
#   "~/gadgets/filesystem.ts",
#   "~/gadgets/calculator.ts",
# ]
# parameter-format = "toml"              # json, yaml, toml, or auto
# builtins = true                        # Enable built-in gadgets (AskUser, TellUser)
# builtin-interaction = true             # Enable AskUser (set false for non-interactive)
# quiet = false                          # Suppress all output except content and TellUser

#──────────────────────────────────────────────────────────────────────────────
# PROMPT TEMPLATES
# Define reusable prompt snippets that can be composed together.
# Use <%~ include("@name") %> to include, <%= it.var %> for variables.
# Reserved section - cannot be used as a custom command name.
#──────────────────────────────────────────────────────────────────────────────
[prompts]

# Simple base personality - can be included in other prompts
base-assistant = """
You are a helpful, accurate, and thoughtful assistant.
Always be clear and concise in your responses.
"""

# Expert role with specialization parameter
expert-role = """
You are an expert <%= it.domain %> specialist with deep knowledge and practical experience.
Provide thorough, well-reasoned answers backed by best practices.
"""

# Composable: includes base-assistant and adds code review specifics
code-reviewer = """
<%~ include("@base-assistant") %>

When reviewing code:
1. Identify bugs, logic errors, and edge cases
2. Check for security vulnerabilities (injection, XSS, CSRF, etc.)
3. Suggest performance optimizations
4. Note style issues and deviations from best practices
5. Be constructive - explain the "why" behind suggestions
"""

# Composable: includes expert-role with a specific domain
security-expert = """
<%~ include("@expert-role", {domain: "cybersecurity"}) %>

Focus on:
- OWASP Top 10 vulnerabilities
- Secure coding practices
- Authentication and authorization patterns
- Data protection and encryption
"""

# Using environment variables (must be set or config load will fail)
# team-context = """
# Team: <%= it.env.TEAM_NAME %>
# Project: <%= it.env.PROJECT_NAME %>
# Follow team coding standards and conventions.
# """

# Multi-level composition: builds on code-reviewer
senior-reviewer = """
<%~ include("@code-reviewer") %>

As a senior reviewer, also consider:
- Architectural implications
- Maintainability and technical debt
- Testing coverage and strategies
- Documentation quality
"""

# Output format templates for consistent responses
format-structured = """
Structure your response as:
## Summary
(1-2 sentences)

## Details
(main content)

## Recommendations
(actionable items)
"""

format-concise = """
Be extremely concise. Use bullet points. No fluff.
"""

#──────────────────────────────────────────────────────────────────────────────
# PROFILES (base configurations for inheritance)
# These aren't commands themselves, but provide shared settings for commands.
# Any section becomes a CLI command unless it's [global], [complete], or [agent].
#──────────────────────────────────────────────────────────────────────────────

# Base profile for all review-related commands
[review-base]
inherits = "agent"                        # Inherits model, max-iterations, etc. from [agent]
temperature = 0.3                         # Override: lower temperature for consistent reviews
max-iterations = 5                        # Override: fewer iterations for focused tasks

#──────────────────────────────────────────────────────────────────────────────
# CUSTOM COMMANDS
# Any section other than [global], [complete], [agent] creates a new CLI command.
# Custom commands appear in `llmist --help` and can be run like built-in commands.
#──────────────────────────────────────────────────────────────────────────────

# Code review command - inherits from review-base profile
# Usage: llmist code-review "Review this: $(cat myfile.ts)"
#        cat myfile.ts | llmist code-review
[code-review]
inherits = "review-base"                  # Gets model from [agent], temperature from [review-base]
type = "agent"                            # "agent" (default) or "complete"
description = "Review code for bugs, security issues, and best practices."
# Using prompt template - includes the code-reviewer prompt and adds structured output
system = """
<%~ include("@code-reviewer") %>

<%~ include("@format-structured") %>
"""
# gadget = ["~/gadgets/code-analysis.ts"]

# Security-focused code review
# Usage: llmist security-review "$(cat auth.ts)"
[security-review]
inherits = "review-base"
type = "agent"
description = "Security-focused code review."
system = """
<%~ include("@security-expert") %>

<%~ include("@format-structured") %>
"""

# Quick translation command (uses complete mode, no agent loop)
# Usage: llmist translate "Bonjour le monde"
[translate]
inherits = "complete"                     # Inherits model from [complete]
type = "complete"
description = "Translate text to English."
model = "openai:gpt-4o"                   # Override: use OpenAI for translation
system = "Translate the following text to English. Preserve formatting and tone."
temperature = 0.3
max-tokens = 2000

# Summarizer command
# Usage: cat long-document.txt | llmist summarize
[summarize]
inherits = "complete"                     # Inherits model from [complete]
type = "complete"
description = "Summarize text concisely."
system = """
Summarize the following text concisely. Focus on:
- Key points and main ideas
- Important facts and figures
- Actionable conclusions
Keep the summary to 3-5 paragraphs unless the input is very short.
"""
temperature = 0.3

# Shell helper for system administration
# Usage: llmist shell-help "How do I find large files?"
[shell-help]
inherits = "agent"                        # Inherits model, builtins from [agent]
type = "agent"
description = "Get help with shell commands and scripts."
system = """
You are a Unix/Linux shell expert. Help users with:
- Writing shell commands and scripts
- Explaining command output
- Debugging shell issues
Always explain what commands do before suggesting them.
"""
builtin-interaction = false               # Non-interactive mode
max-iterations = 3

# Creative writing assistant
# Usage: llmist write "Write a haiku about programming"
[write]
inherits = "agent"                        # Inherits model from [agent]
type = "agent"
description = "Creative writing assistant."
system = "You are a creative writing assistant. Help with stories, poems, and other creative content. Be imaginative and engaging."
temperature = 0.9                         # Higher temperature for creativity
max-iterations = 3

# Git commit message helper
# Usage: git diff --staged | llmist commit-msg
[commit-msg]
inherits = "complete"                     # Inherits model from [complete]
type = "complete"
description = "Generate a commit message from diff."
system = """
Generate a concise git commit message for the provided diff.
Follow conventional commits format: type(scope): description
Types: feat, fix, docs, style, refactor, test, chore
Keep the first line under 72 characters.
Add bullet points for details if the change is complex.
"""
temperature = 0.3
max-tokens = 500

# Explain code
# Usage: cat complex-function.ts | llmist explain
[explain]
inherits = "complete"                     # Inherits model from [complete]
type = "complete"
description = "Explain what code does."
system = """
<%~ include("@base-assistant") %>

Explain what the provided code does in clear, simple terms:
- Start with a one-sentence summary
- Break down the logic step by step
- Note any important edge cases or assumptions
- Mention potential issues or improvements if relevant
"""
temperature = 0.3

# Architecture review - uses senior-reviewer for comprehensive analysis
# Usage: cat src/**/*.ts | llmist arch-review
[arch-review]
inherits = "review-base"
type = "agent"
description = "Review code architecture and design."
system = """
<%~ include("@senior-reviewer") %>

<%~ include("@format-structured") %>
"""
max-iterations = 10
